
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="
">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://xlingyun.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="xlingyun.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170429/tu-pian-yu-jia-zai/">图片预加载</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-29T02:29:44+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170428/javascriptkuang-jia-she-ji-jie-shao/">Javascript框架设计介绍</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-28T21:53:08+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>9:53 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>思路：</h3>

<ol>
<li>选择引擎</li>
<li>dom操作模块（增删）</li>
<li>事件模块click，on， 。。</li>
<li>属性模块attr，text，html，val，。。。</li>
<li>样式模块css，hasClass，。。</li>
<li>动画模块（*****）</li>
<li>整合</li>
</ol>


<h4>选择器</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;p&gt;&lt;/p&gt;</span>
</span><span class='line'>    <span class="nt">&lt;p&gt;&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="mi">1</span> <span class="err">获得所有的元素</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">divs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span> <span class="s1">&#39;div&#39;</span> <span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">ps</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span> <span class="s1">&#39;p&#39;</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="mi">2</span><span class="p">.</span><span class="err">遍历添加样式</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">divs</span><span class="p">.</span><span class="nx">lenght</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">divs</span><span class="p">[</span> <span class="nx">i</span> <span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">ps</span><span class="p">[</span> <span class="nx">i</span> <span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 传统的处理方式，就是用使用函数获得</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 函数化</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">divs</span> <span class="o">=</span> <span class="nx">g</span><span class="p">(</span> <span class="s1">&#39;div&#39;</span> <span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">ps</span> <span class="o">=</span> <span class="nx">g</span><span class="p">(</span> <span class="s1">&#39;p&#39;</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 性能</span>
</span><span class='line'><span class="c1">// 两个循环</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">arr</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">arr</span><span class="p">[</span> <span class="nx">i</span> <span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">each</span><span class="p">(</span> <span class="nx">divs</span> <span class="p">);</span>
</span><span class='line'><span class="nx">each</span><span class="p">(</span> <span class="nx">ps</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 如果你想遍历一个数组， 需要对数组做什么</span>
</span><span class='line'><span class="c1">// 凡是涉及到遍历才可以完成的事情都应该可以做（修改，查询）</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 要求：</span>
</span><span class='line'><span class="c1">// 1， 求和</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">sum</span> <span class="p">)</span>
</span><span class='line'><span class="c1">// 2， 求最大值</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">max</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">max</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">max</span><span class="p">)</span>
</span><span class='line'><span class="c1">// 3， 求最小值</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">min</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">min</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">min</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">min</span><span class="p">)</span>
</span><span class='line'><span class="c1">// 4， 查找3</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">find1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">find1</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 5， 查找5</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">find2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">find2</span> <span class="o">=</span><span class="nx">i</span><span class="p">;</span>
</span><span class='line'>        <span class="k">break</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">fn</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 求和</span>
</span><span class='line'><span class="nx">each</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 判断大小</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
</span><span class='line'><span class="nx">each</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="nx">max</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">max</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 查找</span>
</span><span class='line'><span class="c1">// 对each进行修改</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>        <span class="c1">// var res = fn(i, arr[i]);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">each</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">v</span> <span class="o">==</span> <span class="mi">3</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">index</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">index</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">getTag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">fn</span><span class="p">){</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">list1</span> <span class="o">=</span> <span class="nx">getTag</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">list2</span> <span class="o">=</span> <span class="nx">getTag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">each</span><span class="p">(</span> <span class="nx">list1</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">each</span><span class="p">(</span> <span class="nx">list2</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 如果利用get方法获得多个元素的话，就会得到多个数组</span>
</span><span class='line'><span class="c1">// 为了简化开发，可以考虑将其合并到一个数组中</span>
</span><span class='line'><span class="c1">// 调用多次get方法，如果想要多个数组就可以使用多个数组</span>
</span><span class='line'><span class="c1">// 想要一个数组，就得到一个数组</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">getTag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">retsults</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">results</span> <span class="o">=</span> <span class="nx">results</span> <span class="o">||</span> <span class="p">[];</span>
</span><span class='line'>    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">tag</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">fn</span><span class="p">){</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">getTag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="nx">getTag</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="nx">each</span><span class="p">(</span> <span class="nx">list</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170428/es6xue-xi/">ES6学习</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-28T20:13:22+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>8:13 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>默认参数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">#</span> <span class="err">为了增强代码的安全性，通过或</span><span class="p">(</span><span class="o">||</span><span class="p">)</span><span class="err">运算符来保证参数正常</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">txt</span> <span class="o">=</span> <span class="nx">txt</span> <span class="o">||</span> <span class="s1">&#39;hello world&#39;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="err">与</span><span class="nx">ES6</span><span class="err">相比</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">txt</span><span class="o">=</span><span class="s1">&#39;hello world&#39;</span><span class="p">){}</span>
</span></code></pre></td></tr></table></div></figure>


<p>字符串模版：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">#</span> <span class="err">首先要用到第三方的</span><span class="nx">underscore</span><span class="err">库，其次需要调用</span><span class="nx">template</span><span class="p">()</span><span class="err">和</span><span class="nx">compiled</span><span class="p">()</span><span class="err">两个函数</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">compiled</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;hello: &lt;%= name %&gt;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">compiled</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;moe&#39;</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="err">对比</span><span class="nx">ES6</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;moe&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">txt</span> <span class="o">=</span> <span class="err">`</span><span class="nx">hello</span> <span class="nx">$</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>更多特性</p>

<h3>解构赋值</h3>

<h3>箭头函数</h3>

<h3>Set和Map</h3>

<h3>异步操作</h3>

<h3>类与对象</h3>

<h3>模块化</h3>

<p>ES6浏览器本身是不支持的，</p>

<h3>ES6项目构建</h3>

<h4>基础框架</h4>

<p><img src="http://oot79f1a9.bkt.clouddn.com/WX20170428-204740.png" alt="基础架构" /></p>

<h4>任务自动化</h4>

<h4>编译工具</h4>

<h4>代码实现</h4>

<h4>任务自动化gulp</h4>

<p>为什么不用grunt：项目复杂后操作慢，gulp因为是级联操作，不是文件流操作
什么是任务自动化
什么是gulp
gulp的作用
了解如何使用gulp完成任务自动化
gulp学习建议：gulp中文网了解基本的api，了解使用哪些插件</p>

<p>编译工具（babel、webpack）
什么是babel、webpack
babel是javascript的编译工具
webpack解决模块化
babel的核心用法
了解webpack及webpack-stream的作用</p>

<h3>代码实现</h3>

<p>创建一个ES6前端工程</p>

<p>完成目录结构、自动构建、服务器搭建</p>

<p>疑问：模版文件文件为什么不是.html呢？
很简单，我们的服务端是通过express这个nodejs框架做的，而express使用的模版引擎就是ejs</p>

<p>使用<code>express -e .</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">第一步：</span>
</span><span class='line'><span class="nx">express</span> <span class="err">脚手架的一个启动命令</span>
</span><span class='line'><span class="o">-</span><span class="nx">e</span> <span class="err">表示使用</span><span class="nx">ejs</span><span class="err">模版</span>
</span><span class='line'><span class="p">.</span><span class="err">表示在当前页面执行</span>
</span><span class='line'>
</span><span class='line'><span class="err">第二步：</span>
</span><span class='line'><span class="nx">npm</span> <span class="nx">install</span>
</span><span class='line'>
</span><span class='line'><span class="err">以上，服务器代码安装完成</span>
</span></code></pre></td></tr></table></div></figure>


<p>构建目录
功能：文件合并 脚本编译 模版的自动更新等等
util目录： 放置一些常用的脚本</p>

<p><code>npm init</code>, 创建package.json
<code>touch .babelrc</code>，这个必须这样写，babel编译的时候会自动找这个文件，如果找不到就没法读到配置
<code>touch gulpfile.babel.js</code> 官方说要创建gulpfile.js。但是， 因为接下来使用的构建脚本都是es6语法的缘故，如果不加babel.js的话会报错</p>

<p>引入一个包<code>yargs</code>，处理命令行参数，区分开发环境和线上环境</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">yargs</span> <span class="nx">from</span> <span class="s1">&#39;yargs&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>gulp -production</code> 命令中的-production 就是<code>.option('')</code>部分，用来提取参数的</p>

<p>所有的构建脚本一定是放在tasks目录下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">gulp</span> <span class="nx">from</span> <span class="s1">&#39;gulp&#39;</span><span class="p">;</span> <span class="err">#因为整个的构建都是基于</span><span class="nx">gulp</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">gulp</span> <span class="nx">from</span> <span class="s1">&#39;gulp-if&#39;</span><span class="p">;</span> <span class="err">#</span><span class="nx">gulp</span><span class="err">的语句中做判断的</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">concat</span> <span class="nx">from</span> <span class="s1">&#39;gulp-concat&#39;</span><span class="p">;</span> <span class="err">#处理文件拼接的</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">webpack</span> <span class="nx">from</span> <span class="s1">&#39;webpack&#39;</span><span class="p">;</span> <span class="err">#打包工具，整个的打包过程</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">gulpWebpack</span> <span class="nx">from</span> <span class="s1">&#39;webpack-stream&#39;</span><span class="p">;</span> <span class="err">#</span><span class="nx">gulp</span><span class="err">处理的都是文件流，是基于</span><span class="nx">stream</span><span class="err">的，所以与</span><span class="nx">webpack</span><span class="err">的处理是结合</span><span class="nx">webpack</span><span class="o">-</span><span class="nx">stream</span><span class="err">来处理的</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">named</span> <span class="nx">from</span> <span class="s1">&#39;vinyl-named&#39;</span> <span class="err">#文件重命名</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">livereload</span> <span class="nx">from</span> <span class="s1">&#39;gulp-livereload&#39;</span><span class="p">;</span> <span class="err">#</span> <span class="err">文件热更新</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">plumber</span> <span class="nx">from</span> <span class="s1">&#39;gulp-plumber&#39;</span><span class="p">;</span> <span class="err">#</span> <span class="err">处理文件信息流</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">rename</span> <span class="nx">from</span> <span class="s1">&#39;gulp-rename&#39;</span><span class="p">;</span> <span class="err">#</span> <span class="err">对文件重命名</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">uglify</span> <span class="nx">from</span> <span class="s1">&#39;gulp-uglify&#39;</span><span class="p">;</span> <span class="err">#</span> <span class="err">处理</span><span class="nx">js</span><span class="err">和</span><span class="nx">css</span><span class="err">压缩的</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span><span class="nx">log</span><span class="p">,</span> <span class="nx">colors</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;gulp-util&#39;</span><span class="p">;</span> <span class="err">#</span> <span class="err">命令行工具输出</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">args</span> <span class="nx">from</span> <span class="s1">&#39;./util/args&#39;</span><span class="p">;</span> <span class="err">#</span> <span class="err">对命令行参数解析</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">,</span> <span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="s1">&#39;app/js/index.js&#39;</span><span class="p">])</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">plumber</span><span class="p">({</span>
</span><span class='line'>            <span class="nx">errorHandle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}))</span> <span class="c1">//用plumber处理错误</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">named</span><span class="p">())</span><span class="c1">// 文件重新命名</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulpWebpack</span><span class="p">({</span>
</span><span class='line'>            <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">loaders</span><span class="o">:</span> <span class="p">[{</span>
</span><span class='line'>                    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel&#39;</span>
</span><span class='line'>                <span class="p">}]</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}),</span><span class="kc">null</span><span class="p">,(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
</span><span class='line'>            <span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Finished</span> <span class="s1">&#39;${colors.cyan(&#39;</span><span class="nx">scripts</span><span class="s1">&#39;)}&#39;</span><span class="err">`</span><span class="p">,</span><span class="nx">stats</span><span class="p">.</span><span class="nx">toString</span><span class="p">({</span>
</span><span class='line'>                <span class="nx">chunks</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>            <span class="p">}))</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;server/public/js&#39;</span><span class="p">))</span><span class="c1">// 指定路径 tips：为什么要放到server 目录下？因为server要拿到最新的js才能在整个服务中跑起来</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">({</span>
</span><span class='line'>            <span class="nx">basename</span><span class="o">:</span> <span class="s1">&#39;cp&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">extname</span><span class="o">:</span><span class="s1">&#39;.min.js&#39;</span>
</span><span class='line'>        <span class="p">}))</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">uglify</span><span class="p">({</span><span class="nx">compress</span><span class="o">:</span><span class="p">{</span><span class="nx">properties</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span><span class="nx">output</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;quote_keys&#39;</span><span class="o">:</span><span class="kc">true</span><span class="p">}}))</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;server/public/js&#39;</span><span class="p">))</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulpif</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">watch</span><span class="p">,</span><span class="nx">livereload</span><span class="p">()))</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ES6语法</h3>

<p>let和const</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'> <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'> <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如上定义变量会报错<code>Module build failed: Duplicate declaration "a"</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">PI</span> <span class="o">=</span> <span class="mf">3.1415926</span><span class="p">;</span>
</span><span class='line'><span class="nx">PI</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">PI</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>如上，想要修改const定义的常量，会报<code>SyntaxError: "PI" is read-only</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">a</span> <span class="o">:</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">k</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span> <span class="c1">// Object{a:1, b:2}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>解构赋值</h4>

<p>如果解构赋值没有在结构上成功配对，那么声明的那个变量就为<code>undefined</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">let</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">rest</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span><span class="c1">// c: undefined</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="o">=</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span><span class="c1">//</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">);</span><span class="c1">// a:1 b:2 c:3</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170427/gao-xing-neng-gun-dong-scrollji-ye-mian-xuan-ran-you-hua/">高性能滚动scroll及页面渲染优化</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-27T01:35:25+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>1:35 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>滚动优化的由来</h3>

<p>滚动优化其实也不仅仅指滚动(scroll 事件)，还包括了例如 resize 这类会频繁触发的事件。简单的看看：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">},</span><span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出如下：</p>

<p> <img src="http://oot79f1a9.bkt.clouddn.com/qUVzUjJ.gif" alt="scroll" /></p>

<p>  在绑定 scroll 、resize 这类事件时，当它发生时，它被触发的频次非常高，间隔很近。如果事件中涉及到大量的位置计算、DOM 操作、元素重绘等工作且这些工作无法在下一个 scroll 事件触发前完成，就会造成浏览器掉帧。加之用户鼠标滚动往往是连续的，就会持续触发 scroll 事件导致掉帧扩大、浏览器 CPU 使用率增加、用户体验受到影响。</p>

<p>  在滚动事件中绑定回调应用场景也非常多，在图片的懒加载、下滑自动加载数据、侧边浮动导航栏等中有着广泛的应用。</p>

<p>  当用户浏览网页时，拥有平滑滚动经常是被忽视但却是用户体验中至关重要的部分。当滚动表现正常时，用户就会感觉应用十分流畅，令人愉悦，反之，笨重不自然卡顿的滚动，则会给用户带来极大不舒爽的感觉。</p>

<h3>滚动与页面渲染的关系</h3>

<p>为什么滚动事件需要去优化?因为它影响了性能。那它影响了什么性能呢?额……这个就要从页面性能问题由什么决定说起。</p>

<p>我觉得搞技术一定要追本溯源，不要看到别人一篇文章说滚动事件会导致卡顿并说了一堆解决方案优化技巧就如获至宝奉为圭臬，我们需要的不是拿来主义而是批判主义，多去源头看看。</p>

<p>从问题出发，一步一步寻找到最后，就很容易找到问题的症结所在，只有这样得出的解决方法才容易记住。</p>

<p>说教了一堆废话，不喜欢的直接忽略哈，回到正题，要找到优化的入口就要知道问题出在哪里，对于页面优化而言，那么我们就要知道页面的渲染原理：</p>

<p>浏览器渲染原理我在我上一篇文章里也要详细的讲到，不过更多的是从动画渲染的角度去讲的：《【Web动画】CSS3 3D 行星运转 &amp;&amp; 浏览器渲染原理》 。</p>

<p>想了想，还是再简单的描述下，我发现每次 review 这些知识点都有新的收获，这次换一张图，以 chrome 为例子，一个 Web 页面的展示，简单来说可以认为经历了以下下几个步骤：</p>

<p><img src="http://oot79f1a9.bkt.clouddn.com/QQ20170427-020151.png" alt="滚动与页面渲染的关系" /></p>

<ul>
<li>JavaScript：一般来说，我们会使用 JavaScript 来实现一些视觉变化的效果。比如做一个动画或者往页面里添加一些 DOM 元素等。</li>
<li>Style：计算样式，这个过程是根据 CSS 选择器，对每个 DOM 元素匹配对应的 CSS 样式。这一步结束之后，就确定了每个 DOM 元素上该应用什么 CSS 样式规则。</li>
<li>Layout：布局，上一步确定了每个 DOM 元素的样式规则，这一步就是具体计算每个 DOM 元素最终在屏幕上显示的大小和位置。web 页面中元素的布局是相对的，因此一个元素的布局发生变化，会联动地引发其他元素的布局发生变化。比如， 元素的宽度的变化会影响其子元素的宽度，其子元素宽度的变化也会继续对其孙子元素产生影响。因此对于浏览器来说，布局过程是经常发生的。</li>
<li>Paint：绘制，本质上就是填充像素的过程。包括绘制文字、颜色、图像、边框和阴影等，也就是一个 DOM 元素所有的可视效果。一般来说，这个绘制过程是在多个层上完成的。</li>
<li>Composite：渲染层合并，由上一步可知，对页面中 DOM 元素的绘制是在多个层上进行的。在每个层上完成绘制过程之后，浏览器会将所有层按照合理的顺序合并成一个图层，然后显示在屏幕上。对于有位置重叠的元素的页面，这个过程尤其重要，因为一旦图层的合并顺序出错，将会导致元素显示异常。
这里又涉及了层(GraphicsLayer)的概念，GraphicsLayer 层是作为纹理(texture)上传给 GPU 的，现在经常能看到说 GPU 硬件加速，就和所谓的层的概念密切相关。但是和本文的滚动优化相关性不大，有兴趣深入了解的可以自行 google 更多。</li>
</ul>


<p>简单来说，网页生成的时候，至少会渲染(Layout+Paint)一次。用户访问的过程中，还会不断重新的重排(reflow)和重绘(repaint)。</p>

<p>其中，用户 scroll 和 resize 行为(即是滑动页面和改变窗口大小)会导致页面不断的重新渲染。</p>

<p>当你滚动页面时，浏览器可能会需要绘制这些层(有时也被称为合成层)里的一些像素。通过元素分组，当某个层的内容改变时，我们只需要更新该层的结构，并仅仅重绘和栅格化渲染层结构里变化的那一部分，而无需完全重绘。显然，如果当你滚动时，像视差网站(戳我看看)这样有东西在移动时，有可能在多层导致大面积的内容调整，这会导致大量的绘制工作。</p>

<h3>防抖(Debouncing)</h3>

<p>防抖技术即是可以把多个顺序地调用合并成一次，也就是在一定时间内，规定事件被触发的次数。
通俗一点来说，看看下面这个简化的例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 简单的防抖动函数 </span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">,</span> <span class="nx">immediate</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 定时器变量 </span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">timeout</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 每次触发 scroll handler 时先清除定时器 </span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 指定 xx ms 后触发真正想进行的操作 handler </span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// 实际想绑定在 scroll 事件上的 handler </span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">realFunc</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// 采用了防抖动 </span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span><span class="nx">debounce</span><span class="p">(</span><span class="nx">realFunc</span><span class="p">,</span><span class="mi">500</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 没采用防抖动 </span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span><span class="nx">realFunc</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>  上面简单的防抖的例子可以拿到浏览器下试一下，大概功能就是如果 500ms 内没有连续触发两次 scroll 事件，那么才会触发我们真正想在 scroll 事件中触发的函数。</p>

<p>上面的示例可以更好的封装一下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 防抖动函数 </span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">,</span> <span class="nx">immediate</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">timeout</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">later</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">timeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">immediate</span><span class="p">)</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">callNow</span> <span class="o">=</span> <span class="nx">immediate</span> <span class="o">&amp;</span> <span class="o">!</span><span class="nx">timeout</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">later</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">callNow</span><span class="p">)</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">myEfficientFn</span> <span class="o">=</span> <span class="nx">debounce</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 滚动中的真正的操作 </span>
</span><span class='line'>
</span><span class='line'><span class="p">},</span> <span class="mi">250</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// 绑定监听 </span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="nx">myEfficientFn</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>节流(Throttling)</h3>

<p>  防抖函数确实不错，但是也存在问题，譬如图片的懒加载，我希望在下滑过程中图片不断的被加载出来，而不是只有当我停止下滑时候，图片才被加载出来。又或者下滑时候的数据的 ajax 请求加载也是同理。</p>

<p>  这个时候，我们希望即使页面在不断被滚动，但是滚动 handler 也可以以一定的频率被触发(譬如 250ms 触发一次)，这类场景，就要用到另一种技巧，称为节流函数(throttling)。</p>

<p>  节流函数，只允许一个函数在 X 毫秒内执行一次。</p>

<p>  与防抖相比，节流函数最主要的不同在于它保证在 X 毫秒内至少执行一次我们希望触发的事件 handler。</p>

<p>  与防抖相比，节流函数多了一个 mustRun 属性，代表 mustRun 毫秒内，必然会触发一次 handler ，同样是利用定时器，看看简单的示例：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 简单的节流函数 </span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">,</span> <span class="nx">mustRun</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">timeout</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">startTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">curTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 如果达到了规定的触发时间间隔，触发 handler </span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">curTime</span> <span class="o">-</span> <span class="nx">startTime</span> <span class="o">&gt;=</span> <span class="nx">mustRun</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">curTime</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 没达到触发间隔，重新设定定时器 </span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">wait</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 实际想绑定在 scroll 事件上的 handler </span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">realFunc</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 采用了节流函数 </span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span><span class="nx">throttle</span><span class="p">(</span><span class="nx">realFunc</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>  上面简单的节流函数的例子可以拿到浏览器下试一下，大概功能就是如果在一段时间内 scroll 触发的间隔一直短于 500ms ，那么能保证事件我们希望调用的 handler 至少在 1000ms 内会触发一次。</p>

<p>  使用 rAF(requestAnimationFrame)触发滚动事件</p>

<p>  上面介绍的抖动与节流实现的方式都是借助了定时器 setTimeout ，但是如果页面只需要兼容高版本浏览器或应用在移动端，又或者页面需要追求高精度的效果，那么可以使用浏览器的原生方法 rAF(requestAnimationFrame)。</p>

<p>  requestAnimationFrame</p>

<p>  window.requestAnimationFrame() 这个方法是用来在页面重绘之前，通知浏览器调用一个指定的函数。这个方法接受一个函数为参，该函数会在重绘前调用。</p>

<p>  rAF 常用于 web 动画的制作，用于准确控制页面的帧刷新渲染，让动画效果更加流畅，当然它的作用不仅仅局限于动画制作，我们可以利用它的特性将它视为一个定时器。(当然它不是定时器)</p>

<p>  通常来说，rAF 被调用的频率是每秒 60 次，也就是 1000/60 ，触发频率大概是 16.7ms 。(当执行复杂操作时，当它发现无法维持 60fps 的频率时，它会把频率降低到 30fps 来保持帧数的稳定。)</p>

<p>  简单而言，使用 requestAnimationFrame 来触发滚动事件，相当于上面的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">throttle</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">xx</span><span class="p">,</span> <span class="mi">1000</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="c1">//xx 代表 xx ms内不会重复触发事件 handler </span>
</span></code></pre></td></tr></table></div></figure>


<p>简单的示例如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">ticking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// rAF 触发锁 </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">onScroll</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ticking</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">realFunc</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">ticking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">realFunc</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// do something... </span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">ticking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 滚动事件监听 </span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="nx">onScroll</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>  上面简单的使用 rAF 的例子可以拿到浏览器下试一下，大概功能就是在滚动的过程中，保持以 16.7ms 的频率触发事件 handler。</p>

<p>  使用 requestAnimationFrame 优缺点并存，首先我们不得不考虑它的兼容问题，其次因为它只能实现以 16.7ms 的频率来触发，代表它的可调节性十分差。但是相比 throttle(func, xx, 16.7) ，用于更复杂的场景时，rAF 可能效果更佳，性能更好。</p>

<p>总结一下</p>

<ul>
<li>防抖动：防抖技术即是可以把多个顺序地调用合并成一次，也就是在一定时间内，规定事件被触发的次数。</li>
<li>节流函数：只允许一个函数在 X 毫秒内执行一次，只有当上一次函数执行后过了你规定的时间间隔，才能进行下一次该函数的调用。</li>
<li>rAF：16.7ms 触发一次 handler，降低了可控性，但是提升了性能和精确度。</li>
</ul>


<h3>简化 scroll 内的操作</h3>

<p>  上面介绍的方法都是如何去优化 scroll 事件的触发，避免 scroll 事件过度消耗资源的。</p>

<p>  但是从本质上而言，我们应该尽量去精简 scroll 事件的 handler ，将一些变量的初始化、不依赖于滚动位置变化的计算等都应当在 scroll 事件外提前就绪。</p>

<p>  建议如下：</p>

<p>  避免在scroll事件中修改样式属性/将样式操作从scroll事件中剥离</p>

<p>  <img src="http://oot79f1a9.bkt.clouddn.com/QQ20170427-020130.png" alt="简化scroll" /></p>

<p>  输入事件处理函数，比如 scroll / touch 事件的处理，都会在 requestAnimationFrame 之前被调用执行。</p>

<p>  因此，如果你在 scroll 事件的处理函数中做了修改样式属性的操作，那么这些操作会被浏览器暂存起来。然后在调用 requestAnimationFrame 的时候，如果你在一开始做了读取样式属性的操作，那么这将会导致触发浏览器的强制同步布局。</p>

<h3>滑动过程中尝试使用 pointer-events: none 禁止鼠标事件</h3>

<p>  大部分人可能都不认识这个属性，嗯，那么它是干什么用的呢?</p>

<p>  pointer-events 是一个 CSS 属性，可以有多个不同的值，属性的一部分值仅仅与 SVG 有关联，这里我们只关注 pointer-events: none 的情况，大概的意思就是禁止鼠标行为，应用了该属性后，譬如鼠标点击，hover 等功能都将失效，即是元素不会成为鼠标事件的 target。</p>

<p>  可以就近 F12 打开开发者工具面板，给 标签添加上 pointer-events: none 样式，然后在页面上感受下效果，发现所有鼠标事件都被禁止了。</p>

<p>那么它有什么用呢?</p>

<p>pointer-events: none 可用来提高滚动时的帧频。的确，当滚动时，鼠标悬停在某些元素上，则触发其上的 hover 效果，然而这些影响通常不被用户注意，并多半导致滚动出现问题。对 body 元素应用 pointer-events: none ，禁用了包括 hover 在内的鼠标事件，从而提高滚动性能。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.disable-hover</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="k">pointer</span><span class="o">-</span><span class="n">events</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>  大概的做法就是在页面滚动的时候, 给 添加上 .disable-hover 样式，那么在滚动停止之前, 所有鼠标事件都将被禁止。当滚动结束之后，再移除该属性。</p>

<p>  可以查看这个 demo (<a href="https://dl.dropboxusercontent.com/u/2272348/codez/expensivescroll/demo.html">https://dl.dropboxusercontent.com/u/2272348/codez/expensivescroll/demo.html</a>)页面。</p>

<p>  上面说 pointer-events: none 可用来提高滚动时的帧频 的这段话摘自 pointer-events-MDN ，还专门有文章讲解过这个技术：</p>

<p>  使用pointer-events:none实现60fps滚动 。</p>

<p>  这就完了吗?没有，张鑫旭有一篇专门的文章，用来探讨 pointer-events: none 是否真的能够加速滚动性能，并提出了自己的质疑：</p>

<p>  pointer-events:none提高页面滚动时候的绘制性能?</p>

<p>  结论见仁见智，使用 pointer-events: none 的场合要依据业务本身来定夺，拒绝拿来主义，多去源头看看，动手实践一番再做定夺。</p>

<p>其他参考文献(都是好文章，值得一读)：</p>

<ul>
<li>实例解析防抖动(Debouncing)和节流阀(Throttling)</li>
<li>无线性能优化：Composite</li>
<li>Javascript高性能动画与页面渲染</li>
<li>Google Developers–渲染性能</li>
<li>Web高性能动画</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170426/javascriptyi-bu-bian-cheng/">Javascript异步编程</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-26T23:33:17+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>11:33 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Ajax相关库</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">XHR</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">const</span> <span class="no">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="o">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">responseText</span><span class="p">){</span>
</span><span class='line'>                        <span class="nx">resolve</span><span class="p">(</span><span class="nx">JSON</span><span class="o">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">responseText</span><span class="p">));</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">reject</span><span class="p">(</span><span class="sb">`XHR unsuccessful:`</span> <span class="err">$</span><span class="p">{</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">status</span><span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">send</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">const</span> <span class="no">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="o">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">responseText</span><span class="p">){</span>
</span><span class='line'>                        <span class="nx">resolve</span><span class="p">(</span><span class="nx">JSON</span><span class="o">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">responseText</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                       <span class="nx">reject</span><span class="p">(</span><span class="sb">`XHR unsuccessful:`</span> <span class="err">$</span><span class="p">{</span><span class="nx">xhr</span><span class="o">.</span><span class="nx">status</span><span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">xhr</span><span class="o">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="o">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">XHR</span><span class="o">.</span><span class="nx">install</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Vue</span><span class="o">.</span><span class="nx">prototype</span><span class="o">.</span><span class="nv">$get</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XHR</span><span class="p">()</span><span class="o">.</span><span class="nx">get</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">Vue</span><span class="o">.</span><span class="nx">prototype</span><span class="o">.</span><span class="nv">$post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XHR</span><span class="p">()</span><span class="o">.</span><span class="nx">post</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">export</span> <span class="k">default</span> <span class="nx">XHR</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//这种方法一般能缩小文件几十KB，比如vue-resource有35KB，自己写的这个XHR.js只有1.9K</span>
</span></code></pre></td></tr></table></div></figure>


<h3>12个非常有用的JavaScript技巧</h3>

<p>作用：减少并优化代码</p>

<h4>1.使用<code>!!</code>将变量转换成布尔类型</h4>

<p>有时，我们需要检查一些变量是否存在，或者它是否具有有效值，从而将它们的值视为true。对于做这样的检查，你可以使用||（双重否定运算符），它能自动将任何类型的数据转换为布尔值，只有这些变量才会返回false：0，null，"&ldquo;，undefined或NaN，其他的都返回true。我们来看看这个简单的例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Account</span><span class="p">(</span><span class="nx">cash</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">cash</span> <span class="o">=</span> <span class="nx">cash</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">hasMoney</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">cash</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">account</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">(</span><span class="mf">100.50</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">cash</span><span class="p">);</span> <span class="c1">//100.50</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">hasMoney</span><span class="p">);</span> <span class="c1">//true</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">emptyAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">cash</span><span class="p">);</span> <span class="c1">//0</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">hasMoney</span><span class="p">);</span> <span class="c1">// false</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 在这个例子中，如果account.cash的值大于零，则account.hasMoney的值就是true</span>
</span></code></pre></td></tr></table></div></figure>


<h4>2.使用<code>+</code>将变量转化成数字</h4>

<p>这个转换超级简单，但它只适用于数字字符串，不然就会返回NaN（ 不是数字 ）。看看这个例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">strNumber</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">+</span><span class="nx">strNumber</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toNumber</span><span class="p">(</span><span class="s1">&#39;1234&#39;</span><span class="p">));</span> <span class="c1">//1234</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">toNumber</span><span class="p">(</span><span class="s1">&#39;ACB&#39;</span><span class="p">));</span> <span class="c1">//NaN</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 这个转换操作也可以作用于Date，在这种情况下，他将返回时间戳</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="c1">//</span>
</span></code></pre></td></tr></table></div></figure>


<h4>3.短路条件</h4>

<p>如果你看到过这种类似的代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">conected</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">login</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 那么你可以在这两个变量之间使用&amp;&amp;（AND运算符）来缩短代码。例如，前面的代码可以缩减到一行：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">conected</span> <span class="o">&amp;&amp;</span> <span class="nx">login</span><span class="p">();</span>
</span><span class='line'><span class="c1">// 你也可以用这种方法来检查对象中是否存在某些属性或函数。类似于以下代码：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">user</span> <span class="o">&amp;&amp;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">login</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h4>4.使用<code>||</code>设置默认值</h4>

<p>在ES6中有默认参数这个功能。为了在旧版浏览器中模拟此功能，你可以使用||（OR运算符），并把默认值作为它的第二个参数。如果第一个参数返回false，那么第二个参数将会被作为默认值返回。看下这个例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">User</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">||</span> <span class="s2">&quot;Oliver Queen&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span> <span class="o">||</span> <span class="mi">27</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user1</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">//Oliver Queen</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user1</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span> <span class="c1">//27</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="s1">&#39;Barry Allen&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user2</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">//Barry Allen</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user2</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span> <span class="c1">//25</span>
</span></code></pre></td></tr></table></div></figure>


<h4>5.在循环中缓存<code>array.length</code></h4>

<p>这个技巧非常简单，并且在循环处理大数组时能够避免对性能造成巨大的影响。基本上几乎每个人都是这样使用for来循环遍历一个数组的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果你使用较小的数组，那还好，但是如果处理大数组，则此代码将在每个循环里重复计算数组的大小，这会产生一定的延迟。为了避免这种情况，你可以在变量中缓存array.length，以便在循环中每次都使用缓存来代替array.length：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 为了更简洁，可以这么写：</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>6.检测对象中的属性</h4>

<p>当你需要检查某些属性是否存在，避免运行未定义的函数或属性时，这个技巧非常有用。如果你打算编写跨浏览器代码，你也可能会用到这个技术。例如，我们假设你需要编写与旧版Internet Explorer 6兼容的代码，并且想要使用document.querySelector()来通过ID获取某些元素。 但是，在现代浏览器中，这个函数不存在。所以，要检查这个函数是否存在，你可以使用in运算符。看下这个例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span><span class="p">(</span><span class="s1">&#39;querySelector&#39;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#id&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>7.获取数组的最后一个元素</h4>

<p><code>Array.prototype.slice(begin, end)</code>可以用来裁剪数组。但是如果没有设置结束参数end的值的话，该函数会自动将end设置为数组长度值。我认为很少有人知道这个函数可以接受负值，如果你将begin设置一个负数的话，你就能从数组中获取到倒数的元素：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">//[6]</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">));</span> <span class="c1">//[5,6]</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">));</span> <span class="c1">//[4,5,6]</span>
</span></code></pre></td></tr></table></div></figure>


<h4>8.数组截断</h4>

<p>这个技术可以锁定数组的大小，这对于要删除数组中固定数量的元素是非常有用的。例如，如果你有一个包含10个元素的数组，但是你只想获得前五个元素，则可以通过设置array.length = 5来阶段数组。看下这个例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">//6</span>
</span><span class='line'><span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">//3</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span> <span class="c1">//[1,2,3]</span>
</span></code></pre></td></tr></table></div></figure>


<h4>9.全部替换</h4>

<p>String.replace()函数允许使用String和Regex来替换字符串，这个函数本身只能替换第一个匹配的串。但是你可以在正则表达式末尾添加/g来模拟replaceAll()函数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">string</span> <span class="o">=</span> <span class="s2">&quot;john john&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/hn/</span><span class="p">,</span><span class="s2">&quot;ana&quot;</span><span class="p">));</span> <span class="c1">//&quot;joana john&quot;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/hn/g</span><span class="p">,</span><span class="s2">&quot;ana&quot;</span><span class="p">));</span> <span class="c1">//&quot;joana joana&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>10.合并数组</h4>

<p>如果你需要合并两个数组，你可以使用Array.concat()函数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">array1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">array2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array1</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">array2</span><span class="p">));</span> <span class="c1">//[1,2,3,4,5,6];</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是，这个函数对于大数组来说不并合适，因为它将会创建一个新的数组并消耗大量的内存。在这种情况下，你可以使用 <code>Array.push.apply(arr1,arr2);</code> 它不会创建一个新数组，而是将第二个数组合并到第一个数组中，以减少内存使用：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">array1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">array2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array1</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">array1</span><span class="p">,</span> <span class="nx">array2</span><span class="p">));</span> <span class="c1">//[1,2,3,4,5,6];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>11.把NodeList转换成数组</h4>

<p>如果运行document.querySelectorAll(&ldquo;p&rdquo;)函数，它会返回一个DOM元素数组，即NodeList对象。但是这个对象并没有一些属于数组的函数，例如：sort()，reduce()，map()，filter()。为了启用这些函数，以及数组的其他的原生函数，你需要将NodeList转换为数组。要进行转换，只需使用这个函数：[].slice.call(elements);</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">arrayElements</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elements</span><span class="p">);</span><span class="c1">//现在已经转换成数组了</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">arrayElements</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">elements</span><span class="p">);</span><span class="c1">//把NodeList转化成数组的另外一个方法</span>
</span></code></pre></td></tr></table></div></figure>


<h4>12.对数组元素进行洗牌</h4>

<p>如果要像外部库Lodash那样对数据元素重新洗牌，只需使用这个技巧</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span class='line'><span class="p">}));</span> <span class="c1">//[2,1,3]</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170426/homebrewzong-jie/">Homebrew总结</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-26T22:17:29+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:17 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://brew.sh/index_zh-cn.html">HomeBrew</a>就是MacOS下最著名的包管理器，我使用它的目的就是让MacOS下的命令行和Linux下一样顺手。</p>

<ul>
<li>安装</li>
<li>基本操作

<ul>
<li>安装一个包</li>
<li>卸载与跟新</li>
</ul>
</li>
<li>扩展</li>
<li>更换源</li>
<li>Homebrew中一些路径的解释</li>
<li>MacOS下gnu命令行</li>
</ul>


<h4>安装</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">ruby</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面这句话的意思是使用curl命令行下载安装脚步install，然后用ruby解析执行这个安装脚步。</p>

<p>安装好之后</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">echo</span> <span class="s1">&#39;export PATH=&quot;/usr/local/bin:$PATH&quot;&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~</span><span class="sr">/.bash_profile</span>
</span></code></pre></td></tr></table></div></figure>


<p>后面的<code>.bash_profile</code>请根据你使用shell的情况来修改。</p>

<p>现在homebrew的最新版本是1.0.0。</p>

<p>使用以下命令查看版本。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="o">-</span><span class="n">v</span>
</span></code></pre></td></tr></table></div></figure>


<h4>基本操作</h4>

<h6>安装一个包</h6>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">formula</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是麻烦的是你往往不记得包名或者记不全，这里有两个方法，第一个是使用<code>brew search</code>进行搜索，比如你想找vim这个包，但你只记得了前面两个字母，最后一个 <strong>m</strong> 给忘记了，这时候你可以尝试下面但命令：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">search</span> <span class="n">vi</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果出来了，但是结果太多了，包括了很多不是 <strong>vi</strong> 开头的包，这个时候你就得用正则表达式来搜索，这对小白来说也是非常痛苦的，因为要学会正则表达式也得看一本书，但是一旦你熟悉它之后，你会发现你会在每个搜索的场景下都希望它支持正则表达式的搜索，正如你熟悉了编辑器vim之后，希望处处都是vim模式一样。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">search</span> <span class="sr">/正则表达式/</span> <span class="c1"># 标准格式</span>
</span><span class='line'><span class="n">brew</span> <span class="n">search</span> <span class="sr">/^vi/</span>   <span class="c1">#规定了只能是vi开头</span>
</span><span class='line'><span class="n">brew</span> <span class="n">search</span> <span class="sr">/^vi\\w$/</span>   <span class="c1">#规定只能是vi开头并且只有三个字母</span>
</span></code></pre></td></tr></table></div></figure>


<p>第二种方法更适合小白用户，前提是你安装了oh-my-zsh，使用过<a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a>的用户都知道其补全功能非常牛逼，它可以补全命令，命令的选项和参数，还可以补全包管理器的包名，是不是很厉害，但是默认oh-my-zsh是不支持HomeBrew的，所以我们需要这样做：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">zsh</span><span class="o">-</span><span class="n">completions</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用homebrew安装原本需要图形安装的软件比如chrome。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">cask</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">formula</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>一般来说不带任何选项的话，homebrew会优先下载二进制，二进制下载不到就会尝试从源码编译，这也是homebrew强大的地方之处。</p>

<p>比如，我们希望更新最新的vim，这就得从源码编译了，从源码编译过vim的人都知道，有很多选项要用户决定，然后homebrew是如何做到的呢，我们该如何指定选项呢？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">info</span> <span class="o">&lt;</span><span class="n">formula</span><span class="o">&gt;</span>  <span class="c1">#查看这个包的信息，从中我们可以得知有哪些选项可选。</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#示例</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">vim</span> <span class="o">--</span><span class="no">HEAD</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">override</span><span class="o">-</span><span class="nb">system</span><span class="o">-</span><span class="n">vi</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">lua</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后，homebrew就会帮我们解决编译过程中的任何依赖了，是不是很爽？</p>

<p>细心的人可能也注意到了，并没有找到所有在vim源码makefile中的提供的选项，这是因为支持什么选项取决于该包对应的 <strong>formula</strong> 文件，通常位于<code>/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula</code>文件夹中，你可以使用下面的命令来编辑它，该文件遵循ruby语法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">edit</span> <span class="o">&lt;</span><span class="n">package_name</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>卸载与跟新</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 卸载对应包名字</span>
</span><span class='line'><span class="n">brew</span> <span class="n">uninstall</span> <span class="o">&lt;</span><span class="n">package_name</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1"># 列出过时的包</span>
</span><span class='line'><span class="n">brew</span> <span class="n">outdated</span>
</span><span class='line'><span class="c1"># 更新过时的包，不带包名就更新所有包</span>
</span><span class='line'><span class="n">brew</span> <span class="n">upgrade</span> <span class="o">[</span> <span class="n">package_name</span> <span class="o">]</span>
</span><span class='line'><span class="c1"># 更新HomeBrew自身</span>
</span><span class='line'><span class="n">brew</span> <span class="n">update</span>
</span><span class='line'><span class="c1"># 清除缓存</span>
</span><span class='line'><span class="n">brew</span> <span class="n">cleanup</span> <span class="o">[</span><span class="err">包名</span><span class="o">]</span>
</span><span class='line'><span class="c1"># 列出已经安装的包</span>
</span><span class='line'><span class="n">brew</span> <span class="n">list</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果该包有多个版本，那么先使用<code>brew switch &lt;包名&gt; &lt;版本号&gt;</code>来切换到该版本然后再使用<code>uninstall</code>来卸载，如果卸载全部版本那么使用<code>--force</code>选项。</p>

<h4>扩展</h4>

<p>就像ubuntu的ppa一样，很多时候有些软件包并不在官方提供列表里面而是由第三方提供的这个时候，我们就需要使用下面的命令：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="o">[</span><span class="n">un</span><span class="o">]</span><span class="n">tap</span> <span class="o">&lt;</span><span class="n">github_userid</span><span class="o">/</span><span class="n">repo_name</span><span class="o">&gt;</span> <span class="c1">#添加或者删除仓库</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意<code>repo_name</code>只是实际仓库名的一部分，而实际仓库名的前缀必须是<code>homebrew-</code>。比如</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">tap</span> <span class="n">neovim</span><span class="o">/</span><span class="n">neovim</span>
</span><span class='line'><span class="c1"># 这样实际仓库名就是homebrew-neovim</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/Homebrew/brew/blob/master/docs/brew-tap.md">官方文档</a>中提出brew tap作用用于添加更多仓库，默认情况下tap假设这些仓库来源于<a href="https://github.com">github</a>，但又不局限于它。</p>

<p>不带参数的话，将会列出当前已经<code>tapped</code>的仓库，比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">tap</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="no">Auto</span><span class="o">-</span><span class="n">updated</span> <span class="no">Homebrew</span><span class="o">!</span>
</span><span class='line'><span class="no">Updated</span> <span class="mi">1</span> <span class="n">tap</span> <span class="p">(</span><span class="n">homebrew</span><span class="o">/</span><span class="n">core</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="no">No</span> <span class="n">changes</span> <span class="n">to</span> <span class="n">formulae</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">caskroom</span><span class="o">/</span><span class="n">cask</span>
</span><span class='line'><span class="n">homebrew</span><span class="o">/</span><span class="n">core</span>
</span><span class='line'><span class="n">homebrew</span><span class="o">/</span><span class="n">dupes</span>
</span><span class='line'><span class="n">neovim</span><span class="o">/</span><span class="n">neovim</span>
</span></code></pre></td></tr></table></div></figure>


<p>总共列出了四个仓库，其中前面三个是默认自带的。</p>

<p>如果你要增加的仓库已经存在于<code>homebrew/core</code>中了(名字一样)，你必须显性的安装：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">vim</span>                     <span class="c1"># installs from homebrew/core</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">username</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">vim</span>       <span class="c1"># installs from your custom repo</span>
</span></code></pre></td></tr></table></div></figure>


<h4>更换源</h4>

<p>由于各种原因，用homebrew跟新下载软件有时非常慢，这个时候你可以尝试更换源，这个概念和其它包管理器的概念是一致的，也就是换个软件服务器。</p>

<p>有两个源，第一个是homebrew自身程序公式的服务器地址，homebrew是托管于github，如果你访问这个网站没有问题，那就不需要换了，要换也非常简单，相当于给你的git仓库换一个远程地址，而homebrew的仓库位置默认位于/usr/local/Homebrew下（这个位置是homebrew 1.0之后才变的）。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">cd</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="no">Homebrew</span>
</span><span class='line'><span class="n">git</span> <span class="n">remote</span> <span class="n">set</span><span class="o">-</span><span class="n">url</span> <span class="n">origin</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//mi</span><span class="n">rrors</span><span class="o">.</span><span class="n">ustc</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span><span class="o">/</span><span class="n">homebrew</span><span class="o">.</span><span class="n">git</span>
</span><span class='line'>
</span><span class='line'><span class="n">cd</span> <span class="o">~</span>
</span><span class='line'><span class="n">mkdir</span> <span class="n">tmp</span>
</span><span class='line'><span class="n">cd</span> <span class="n">tmp</span>
</span><span class='line'><span class="n">git</span> <span class="nb">clone</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//mi</span><span class="n">rrors</span><span class="o">.</span><span class="n">ustc</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span><span class="o">/</span><span class="n">homebrew</span><span class="o">.</span><span class="n">git</span>
</span><span class='line'>
</span><span class='line'><span class="n">cp</span> <span class="o">-</span><span class="n">R</span> <span class="n">homebrew</span><span class="o">/.</span><span class="n">git</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="no">Homebrew</span>
</span><span class='line'><span class="n">cp</span> <span class="o">-</span><span class="n">R</span> <span class="n">homebrew</span><span class="o">/</span><span class="no">Library</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="no">Homebrew</span>
</span></code></pre></td></tr></table></div></figure>


<p>第二个源就是二进制的服务器地址，做法很简单就是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">echo</span> <span class="s1">&#39;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~</span><span class="sr">/.zshrc</span>
</span><span class='line'><span class="sr">source ~/</span><span class="o">.</span><span class="n">zshrc</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Homebrew中一些路径的解释</h4>

<p>Homebrew 1.0的基础上，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Caskroom</span>  <span class="no">Frameworks</span>  <span class="n">bin</span>  <span class="kp">include</span>  <span class="n">opt</span>   <span class="n">share</span>
</span><span class='line'><span class="no">Cellar</span>    <span class="no">Homebrew</span>    <span class="n">etc</span>  <span class="n">lib</span>      <span class="n">sbin</span>  <span class="n">var</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p><code>Cellar</code>:文件夹存放的是所有包安装所在路径，包括二进制，文档和配置文件，按照这样Cellar/包名/版本号/的形式来安放。</p></li>
<li><p><code>opt</code>:由于版本号随着跟新而改变的，所以需要一个固定不变的路径作为我们访问二进制和文档的路径，这就是opt的作用。</p></li>
<li><p><code>Homebrew</code>:brew程序所在路径.</p></li>
<li><p><code>bin</code>:所有包安装之后二进制都会链接到这个路径下</p></li>
<li><p><code>share</code>:所有包安装之后的文档都会链接到这个路径下</p></li>
<li><p><code>etc</code>:同上，所有包的配置文件</p></li>
<li><p><code>lib</code>:同上，所有包相关库文件</p></li>
<li><p><code>Caskroom</code>:app文件</p></li>
</ul>


<h4>MacOS下gnu命令行</h4>

<p>MacOS下的命令行是bsd的，而且好久没跟新，各种不顺手，所以这一小节的目的是介绍通过homebrew安装gnu的命令行工具代替系统自带的命令行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># GNU File, Shell, and Text utilities</span>
</span><span class='line'><span class="n">brew</span> <span class="n">info</span> <span class="n">coreutils</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">coreutils</span>
</span></code></pre></td></tr></table></div></figure>


<p>从第一条命令得知，安装之后，所有命令都是带有g前缀的，这会让我们非常不爽，所以如果你希望使用它们原来的名字的话，就将这个路径加到PATH变量的最前头。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/opt/coreutils/libexec/gnubin:$PATH&quot;</span> <span class="c1">#这句话放到你shell配置文件中</span>
</span><span class='line'><span class="no">MANPATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/opt/coreutils/libexec/gnuman:$MANPATH&quot;</span> <span class="c1">#默认使用他们的manpage</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看出还是比较麻烦的，而且有些包像binutils并没有提供这样的链接，但是却有g前缀。</p>

<p>下面这些软件也是我们常用的，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">binutils</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">ed</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">findutils</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gawk</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">curl</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">libidn</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">libssh2</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">nghttp2</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">rtmpdump</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gnu</span><span class="o">-</span><span class="n">indent</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gnu</span><span class="o">-</span><span class="n">sed</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gnu</span><span class="o">-</span><span class="n">tar</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gnu</span><span class="o">-</span><span class="n">which</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gnutls</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">grep</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">default</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gzip</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">screen</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">watch</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">wdiff</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">gettext</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">wget</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">bash</span> <span class="n">zsh</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gdb</span>  <span class="c1"># gdb requires further actions to make it work. See `brew info gdb`.</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">gpatch</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">m4</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">make</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">nano</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">rsync</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">svn</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">unzip</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">aria2</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">git</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">ffmpeg</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">ctags</span> <span class="n">cscope</span> <span class="n">the_silver_searcher</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">vim</span> <span class="o">--</span><span class="no">HEAD</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">override</span><span class="o">-</span><span class="nb">system</span><span class="o">-</span><span class="n">vi</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">lua</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">neovim</span> <span class="o">--</span><span class="no">HEAD</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">release</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170426/yii2-dot-0da-zao-wan-zheng-dian-shang-ping-tai/">Yii2.0打造完整电商平台</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-26T21:30:59+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>9:30 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170425/jia-gou-mo-shi-fen-xi-yu-she-ji/">MVC架构模式分析与设计</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-25T21:53:50+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>9:53 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>MVC简介</h3>

<h4>书面解释</h4>

<p>MVC全名是Model View Controller，是模型(model)-视图(view)-控制器(controller)的缩写，一种软件设计典范，用一种业务逻辑和数据显示分离的方法组织代码，将业务逻辑被聚集到一个部件里面，在界面和用户围绕数据的交互能被改进和个性化定制的同时而不需要重新编写业务逻辑。</p>

<p><img src="http://oot79f1a9.bkt.clouddn.com/WX20170425-220721.png" alt="mvc的优势" /></p>

<h4>MVC工作流程</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># testController.class.php控制器文件</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">testController</span><span class="p">{</span>
</span><span class='line'>        <span class="c1"># 控制器的作用是调用模型，并调用视图，将模型产生的数据传递给视图，并让相关视图去显示</span>
</span><span class='line'>        <span class="k">function</span> <span class="nf">show</span><span class="p">(){</span>
</span><span class='line'>            <span class="nv">$testModel</span> <span class="o">=</span> <span class="nx">M</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$testModel</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>            <span class="nv">$testView</span> <span class="o">=</span> <span class="nx">V</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$testView</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># testModel.class.php 模型文件</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">testModle</span><span class="p">{</span>
</span><span class='line'>        <span class="c1"># 模型的作用是获取数据并处理，返回数据</span>
</span><span class='line'>        <span class="k">function</span> <span class="nf">get</span><span class="p">(){</span>
</span><span class='line'>            <span class="k">return</span> <span class="s2">&quot;hello world&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># testView.class.php 视图文件</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">testView</span><span class="p">{</span>
</span><span class='line'>        <span class="c1"># 视图的作用是将取得的数据进行组织、美化等，并最终向用户终端输出</span>
</span><span class='line'>        <span class="k">function</span> <span class="nf">display</span><span class="p">(</span><span class="nv">$data</span><span class="p">){</span>
</span><span class='line'>            <span class="k">echo</span> <span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/********************************************************</span>
</span><span class='line'><span class="sd"> test.php</span>
</span><span class='line'><span class="sd"> require引入有误会报错，include引入有误报警告</span>
</span><span class='line'><span class="sd"> 推荐使用require_once</span>
</span><span class='line'><span class="sd">   - 第一步 浏览者 --&gt; 调用控制器，对他发出指令</span>
</span><span class='line'><span class="sd">   - 第二步 控制器 --&gt; 按指令选取一个合适的模型</span>
</span><span class='line'><span class="sd">   - 第三步 模型 --&gt; 按控制器指令取相应数据</span>
</span><span class='line'><span class="sd">   - 第四步 控制器 --&gt; 按指令选取相应视图</span>
</span><span class='line'><span class="sd">   - 第五步 视图 --&gt; 把第三步取到的数据按用户想要的样式显示出来</span>
</span><span class='line'><span class="sd">*********************************************************/</span>
</span><span class='line'><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;testController.class.php&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;testModel.class.php&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;testView.class.php&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$testController</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">testController</span><span class="p">();</span>
</span><span class='line'><span class="nv">$testController</span><span class="o">-&gt;</span><span class="na">show</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h4>目录规范</h4>

<p><img src="http://oot79f1a9.bkt.clouddn.com/WX20170425-224500.png" alt="目录规范" /></p>

<h4>建立一个控制器调用函数C</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">#####################################################################</span>
</span><span class='line'><span class="c1"># eval()函数调用简单但是不安全</span>
</span><span class='line'><span class="c1"># eval(&#39;$obj = new &#39;.$name.&#39;Controller();$obj-&gt;&#39;.$method.&#39;();&#39;);</span>
</span><span class='line'><span class="c1"># 可用下面代码代替</span>
</span><span class='line'><span class="c1"># $controller = $name.&#39;controller&#39;;</span>
</span><span class='line'><span class="c1"># $obj = new $controller();</span>
</span><span class='line'><span class="c1"># $obj -&gt; $method();</span>
</span><span class='line'><span class="c1">#####################################################################</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">C</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$method</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;libs/Controller/&#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;Controller.class.php&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="c1"># eval 内置函数 把字符串转换为可执行的PHP语句</span>
</span><span class='line'>    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;$obj = new &#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;Controller();$obj-&gt;&#39;</span><span class="o">.</span><span class="nv">$method</span><span class="o">.</span><span class="s1">&#39;();&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1"># 调用</span>
</span><span class='line'><span class="nx">C</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### 建立一个模型调用函数M</span>
</span><span class='line'><span class="k">function</span> <span class="nf">M</span><span class="p">(</span><span class="nv">$name</span><span class="p">){</span>
</span><span class='line'>    <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;libs/Model/&#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;Model.class.php&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;$obj = new &#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;Model();&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$obj</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### 建立一个视图调用函数V</span>
</span><span class='line'><span class="k">function</span> <span class="nf">V</span><span class="p">(</span><span class="nv">$name</span><span class="p">){</span>
</span><span class='line'>    <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;libs/View/&#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;View.class.php&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;$obj = new &#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;View();&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$obj</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。遇到这种情况时可以使用函数 get_magic_quotes_gpc() 进行检测</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">daddslashes</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="o">?</span> <span class="nb">addslashes</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$str</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>入口文件的改造与功能总结</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># index.php 入口文件</span>
</span><span class='line'><span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;function.php&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$controllerAllow</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$methodAllow</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$controller</span> <span class="o">=</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;controller&#39;</span><span class="p">],</span> <span class="nv">$controllerAllow</span><span class="p">)</span> <span class="o">?</span> <span class="nx">daddslashes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;controller&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="s1">&#39;index&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$method</span> <span class="o">=</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">],</span> <span class="nv">$methodAllow</span><span class="p">)</span> <span class="o">?</span> <span class="nx">daddslashes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span> <span class="o">:</span> <span class="s1">&#39;index&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">C</span><span class="p">(</span><span class="nv">$controller</span><span class="p">,</span> <span class="nv">$method</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>什么是好的视图引擎</h4>

<ul>
<li>基于该引擎开发出的模版要更贴近标准的html等</li>
<li>语法简单易懂</li>
<li>良好的缓存机制</li>
<li>扩展性良好</li>
<li>网络资源多</li>
</ul>


<h4>Smarty</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">require</span><span class="p">(</span><span class="s1">&#39;../Smarty.class.php&#39;</span><span class="p">);</span> <span class="c1">//引入smarty</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$smarty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Smarty</span><span class="p">();</span>
</span><span class='line'><span class="c1">//Smarty的 五个配置两个方法</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">left_delimiter</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span><span class="p">;</span><span class="c1">//左定界符</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">right</span><span class="o">-</span><span class="nx">delimiter</span> <span class="o">=</span> <span class="s2">&quot;}&quot;</span><span class="p">;</span><span class="c1">//右定界符</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">template_dir</span> <span class="o">=</span> <span class="s2">&quot;tpl&quot;</span><span class="p">;</span><span class="c1">//html模版的地址</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">compile_dir</span> <span class="o">=</span> <span class="s2">&quot;template_c&quot;</span><span class="p">;</span><span class="c1">//模版编译生成的文件</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">cache_dir</span> <span class="o">=</span> <span class="s2">&quot;cache&quot;</span><span class="c1">//缓存</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//以下是开启缓存的另外两个配置。因为通常不用smarty的缓存机制，所以此项为了了解  </span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">caching</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span> <span class="c1">//开启缓存</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">cache_lifetime</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span> <span class="c1">//缓存时间</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">assign</span><span class="p">(</span><span class="s1">&#39;articletitle&#39;</span><span class="p">,</span> <span class="s1">&#39;文章标题&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$smarty</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">(</span><span class="s1">&#39;test.tpl&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>smarty的注释与变量输出</h4>

<ol>
<li><code>{* 这里是注释语句 *}</code></li>
<li>如何在smarty里面输出赋值进来的变量</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># index.php</span>
</span><span class='line'><span class="c1">#$smarty-&gt;arrign(&#39;articletitle&#39;, &#39;文章标题&#39;);</span>
</span><span class='line'><span class="nv">$arr1</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;smarty的学习&#39;</span><span class="p">,</span><span class="s1">&#39;author&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;小明&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1">#$arr2 = array(&#39;articlecontent&#39;=&gt;array(&#39;title&#39;=&gt;&#39;smarty的学习&#39;,&#39;author&#39;=&gt;&#39;小明&#39;));</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$smarty</span> <span class="o">=</span> <span class="nx">assign</span><span class="p">(</span><span class="s1">&#39;arr&#39;</span><span class="p">,</span> <span class="nv">$arr1</span><span class="p">);</span>
</span><span class='line'><span class="c1"># test.tpl</span>
</span><span class='line'><span class="p">{</span><span class="o">*</span> <span class="p">{</span><span class="nx">articletitle</span><span class="p">}</span> <span class="o">*</span><span class="p">}</span>
</span><span class='line'><span class="p">{</span><span class="nv">$arr1</span><span class="o">.</span><span class="nx">title</span><span class="p">}</span><span class="o">---</span><span class="p">{</span><span class="nv">$arr1</span><span class="o">.</span><span class="nx">author</span><span class="p">}</span>
</span><span class='line'><span class="p">{</span><span class="o">*</span> <span class="p">{</span><span class="nv">$arr2</span><span class="p">[</span><span class="s1">&#39;articlecontent&#39;</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]}</span> <span class="o">--</span> <span class="p">{</span><span class="nv">$arr2</span><span class="p">[</span><span class="s1">&#39;articlecontent&#39;</span><span class="p">][</span><span class="s1">&#39;author&#39;</span><span class="p">]}</span> <span class="o">*</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>变量调节器</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="mi">1</span> <span class="nx">首字母大写capitalize</span>
</span><span class='line'><span class="c1">## 示例：{$articleTitle | capitalize}  </span>
</span><span class='line'><span class="mi">2</span> <span class="nx">字符串连接</span> <span class="nx">cat</span>
</span><span class='line'><span class="c1">## 示例：{$articleTitle | cat:&quot; yesterday.&quot;}  </span>
</span><span class='line'><span class="mi">3</span> <span class="nx">日期格式化</span> <span class="nb">date_format</span>
</span><span class='line'><span class="c1">## 示例：{$yesterday | date_format}  </span>
</span><span class='line'>     <span class="p">{</span><span class="nv">$yesterday</span> <span class="o">|</span> <span class="nb">date_format</span><span class="o">:</span><span class="s2">&quot;:&quot;</span><span class="o">%</span><span class="nx">A</span><span class="p">,</span><span class="o">%</span><span class="nx">B</span> <span class="o">%</span><span class="nx">e</span><span class="p">,</span><span class="o">%</span><span class="nx">Y</span> <span class="o">%</span><span class="nx">H</span><span class="o">:%</span><span class="nx">M</span><span class="o">:%</span><span class="nx">S</span><span class="p">}</span>
</span><span class='line'><span class="mi">4</span> <span class="nx">为未赋值或为空的变量指定默认值default</span>
</span><span class='line'><span class="c1">## 示例：{$articleTitle|default:&quot;no title&quot;}  </span>
</span><span class='line'><span class="mi">5</span> <span class="nx">转码</span> <span class="nx">escape</span>
</span><span class='line'><span class="c1">## 用于html转码，URL转码，在没有转码的变量上转换单引号，十六进制转码，十六进制美化，或者javascript转码，默认是html转码。  </span>
</span><span class='line'><span class="mi">6</span> <span class="nx">小写</span> <span class="nx">lower</span> <span class="nx">大写</span> <span class="nx">upper</span>
</span><span class='line'><span class="c1">## 示例：{$articleTitle|lower}  {$article|upper}  </span>
</span><span class='line'><span class="mi">7</span> <span class="nx">所有的换行符将被替换成</span> <span class="sb">`&lt;br /&gt;`</span> <span class="nx">nl2br功能同PHP中的nl2br</span><span class="p">()</span><span class="nx">函数一样</span>
</span><span class='line'><span class="c1">## 示例：{$articleTitle|nl2br}  </span>
</span><span class='line'><span class="mi">8</span> <span class="nx">其他的函数</span>
</span><span class='line'><span class="c1">## 可以参见手册，原则上应该通过PHP直接处理完再赋值到smarty变量里，少用smarty函数   </span>
</span><span class='line'><span class="c1">## 例如：Wordwrap 行宽 -&gt; 使用css样式来解决俄 truncate  </span>
</span><span class='line'><span class="c1">## 截取 -&gt; 使用PHP来截取，或使用css样式来解决  </span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty中的条件判断</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x"># 1 基本句式</span>
</span><span class='line'><span class="cp">{</span><span class="nf">if</span> <span class="nv">$name</span> <span class="na">eq</span> <span class="s2">&quot;Fred&quot;</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x"> Welcome Sir.</span>
</span><span class='line'><span class="cp">{</span><span class="nf">elseif</span> <span class="nv">$name</span> <span class="na">eq</span> <span class="s2">&quot;Wilma&quot;</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x"> Welcome Ma&#39;am</span>
</span><span class='line'><span class="cp">{</span><span class="nf">else</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x"> Welcome, whatever you are.</span>
</span><span class='line'><span class="cp">{</span><span class="nf">/if</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x"># 2 条件修饰符有很多，简单的几个eq(==) neq(!=) gt(&gt;) lt(&lt;)</span>
</span><span class='line'><span class="x"># 3 修饰词时必须和变量或常量用空格隔开</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty的循环 section</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x">1 section sectionelse</span>
</span><span class='line'><span class="x">### 功能多，参数多。但是个人觉得并不实用，是smarty用来做循环操作的函数之一</span>
</span><span class='line'><span class="x">2 了解基本属性name和loop</span>
</span><span class='line'><span class="x">3 除了name和loop属性外，还有以下属性</span>
</span><span class='line'><span class="x">    start 循环执行的初始位置。如果该值为负数，开始位置从数组的尾部算起。</span>
</span><span class='line'><span class="x">          例如：如果数组中有7个元素，指定start-2，那么指定当前数组的索引为5.</span>
</span><span class='line'><span class="x">          非法值（超过了循环数组的下限）将被自动调整为最接近的合法值。</span>
</span><span class='line'><span class="x">    step  该值决定循环的步长，例如指定step=2将只遍历下标为0 2 4等的元素。</span>
</span><span class='line'><span class="x">          如果step为负值，那么遍历数组的时候从后向前遍历。</span>
</span><span class='line'><span class="x">    max   设定循环最大执行次数</span>
</span><span class='line'><span class="x">    show  决定是否显示该循环</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty的循环 foreach</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x">1 foreach用于处理简单数组（数组中的元素的类型一致），它的格式比section简单许多，</span>
</span><span class='line'><span class="x">  缺点是智能处理简单数组，但是推荐用这个，因为和PHP的语法更接近，容易掌握。错误率低</span>
</span><span class='line'><span class="x">2 foreach在smarty 3里，它可以像PHP一样使用了。</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty的文件引用</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x">1 include用法和PHP里的include差不多</span>
</span><span class='line'><span class="x">2 smarty的include还具备自定义属性的功能</span>
</span><span class='line'><span class="x">  例如</span><span class="cp">{</span><span class="nf">include</span> <span class="na">file</span><span class="o">=</span><span class="s2">&quot;header.tpl&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s2">&quot;网站标题&quot;</span> <span class="na">table_bgcolor</span><span class="o">=</span><span class="s2">&quot;#c0c0c0&quot;</span><span class="cp">}</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty类与对象的赋值与使用</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x">类的调用方法：</span>
</span><span class='line'><span class="x">第一种是用smarty的register_object方法，在Smarty3里已经废除。</span>
</span><span class='line'><span class="x">第二种方法就是使用assign把一个类的对象以变量的形式赋值到smarty模版里使用。</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty函数的使用</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x">1 可以使用PHP内置函数</span>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="c">* ‘|’前是函数的第一个参数‘：’后是第二个参数 *</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="s2">&quot;Y-m-d&quot;</span><span class="o">|</span><span class="na">date</span><span class="o">:</span><span class="nv">$time</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">2 可以自定义函数，并用registerPlugin注册到smarty模版里使用。  </span>
</span><span class='line'><span class="x">  registerPlugin的第一个参数除了function，还有modifier block等</span>
</span><span class='line'>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="c">* 传入的参数1值为abc，传入的参数2值为edf *</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="nf">f_test</span> <span class="na">p1</span><span class="o">=</span><span class="s2">&quot;abc&quot;</span> <span class="na">p2</span><span class="o">=</span><span class="s2">&quot;edf&quot;</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x">  function test($params)</span><span class="cp">{</span>
</span><span class='line'>    <span class="o">{*</span> <span class="na">print_r</span><span class="o">(</span><span class="nv">$params</span><span class="o">)</span>  <span class="o">//</span><span class="na">Array</span><span class="o">([</span><span class="na">p1</span><span class="o">]=&gt;</span><span class="na">abc</span> <span class="o">[</span><span class="na">p2</span><span class="o">]=&gt;</span><span class="na">edf</span><span class="o">)</span> <span class="o">*</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">    $p1 = $params[&#39;p1&#39;];</span>
</span><span class='line'><span class="x">    $p2 = $params[&#39;p2&#39;];</span>
</span><span class='line'><span class="x">    return &#39;传入的参数1值为&#39;.$p1.&#39;,传入的参数2值为&#39;.$p2;</span>
</span><span class='line'><span class="x">  }</span>
</span><span class='line'>
</span><span class='line'><span class="x">  $smarty-&gt;registerPlugin(&#39;function&#39;,&#39;f_test&#39;, &#39;test&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Smarty插件</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='smarty'><span class='line'><span class="x">1 什么是Smarty的插件：</span>
</span><span class='line'><span class="x">  Smarty的插件本质上是function函数</span>
</span><span class='line'>
</span><span class='line'><span class="x">2 Smarty插件常用类型：</span>
</span><span class='line'><span class="x">  functions 函数插件</span>
</span><span class='line'><span class="x">  文件名格式：function.函数名称.php</span>
</span><span class='line'><span class="x">  文件格式：smarty_function_插件名</span>
</span><span class='line'><span class="x">  function smarty_function_test($params)</span><span class="cp">{</span>
</span><span class='line'>    <span class="nv">$width</span> <span class="o">=</span> <span class="nv">$params</span><span class="o">[</span><span class="s1">&#39;width&#39;</span><span class="o">];</span>
</span><span class='line'>    <span class="nv">$height</span> <span class="o">=</span> <span class="nv">$params</span><span class="o">[</span><span class="s1">&#39;height&#39;</span><span class="o">];</span>
</span><span class='line'>    <span class="nv">$area</span> <span class="o">=</span> <span class="nv">$width</span> <span class="o">*</span> <span class="nv">$height</span><span class="o">;</span>
</span><span class='line'>    <span class="na">return</span> <span class="nv">$area</span><span class="o">;</span>
</span><span class='line'>  <span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="c">* {test width=150 height=200} *</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">  modifiers 修饰插件</span>
</span><span class='line'><span class="x">  文件名格式：modifiers.函数名称.php</span>
</span><span class='line'><span class="x">  文件格式：smarty_modifier_插件名</span>
</span><span class='line'><span class="x">  function smarty_modifier_test($uteim, $format)</span><span class="cp">{</span>
</span><span class='line'>    <span class="na">return</span> <span class="na">date</span><span class="o">(</span><span class="nv">$format</span><span class="o">,</span> <span class="nv">$utime</span><span class="o">);</span>
</span><span class='line'>  <span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="c">* {$time | test:&#39;Y-m-d H:i:s&#39;} *</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">  block functions 区块函数插件</span>
</span><span class='line'><span class="x">  文件名格式：block.函数名称.php</span>
</span><span class='line'><span class="x">  文件格式：smarty_block_插件名</span>
</span><span class='line'><span class="x">  function smarty_block_test2($params, $content)</span><span class="cp">{</span>
</span><span class='line'>    <span class="nv">$replace</span> <span class="o">=</span> <span class="nv">$parames</span><span class="o">[</span><span class="s1">&#39;replace&#39;</span><span class="o">];</span>
</span><span class='line'>    <span class="nv">$maxnum</span> <span class="o">=</span> <span class="nv">$params</span><span class="o">[</span><span class="s1">&#39;maxnum&#39;</span><span class="o">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="na">if</span><span class="o">(</span><span class="nv">$replace</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="o">){</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">=</span> <span class="na">str_replace</span><span class="o">(</span><span class="s1">&#39;，&#39;</span><span class="o">,</span><span class="s1">&#39;,&#39;</span><span class="o">,</span><span class="nv">$content</span><span class="o">);</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">=</span> <span class="na">str_replace</span><span class="o">(</span><span class="s1">&#39;。&#39;</span><span class="o">,</span><span class="s1">&#39;.&#39;</span><span class="o">,</span><span class="nv">$content</span><span class="o">);</span>
</span><span class='line'>    <span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">    $content = substr($content, 0, $maxnum);</span>
</span><span class='line'><span class="x">    return $content;</span>
</span><span class='line'><span class="x">  }</span>
</span><span class='line'><span class="x">  </span><span class="cp">{</span><span class="c">* </span>
</span><span class='line'><span class="c">    {test2 replace=&quot;true&quot; maxnum=29} </span>
</span><span class='line'><span class="c">    {$str}</span>
</span><span class='line'><span class="c">    {/test2}</span>
</span><span class='line'><span class="c">  *</span><span class="cp">}</span><span class="x"></span>
</span><span class='line'><span class="x">tips: 插件命名不能重复</span>
</span><span class='line'><span class="x">3 如何来制作 使用插件：</span>
</span><span class='line'><span class="x">  （1）使用registerPlugin方法注册写好的自定义函数</span>
</span><span class='line'><span class="x">  （2）将写好的插件放入Smarty解压目录中的lib目录下的plugins目录里</span>
</span><span class='line'><span class="x">  （3）php的内置函数，可以自动以修饰插件(变量调节器)的形式在模版里使用</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170425/html5pan-duan-wei-xin-,-ios,-androidduan-kou/">Html5判断微信、ios、android端口</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-25T19:04:31+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>7:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">isAndroid</span> <span class="o">=</span> <span class="nx">u</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;Android&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">u</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;Adr&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//android终端</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">isiOS</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">u</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span><span class="p">);</span> <span class="c1">//ios终端</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">getUrlParam</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">passwd</span> <span class="o">=</span> <span class="nx">getUrlParam</span><span class="p">(</span><span class="s1">&#39;passwd&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/MicroMessenger/i</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;micromessenger&quot;</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.start_btn,.down&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
</span><span class='line'>            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.tips&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span><span class="s1">&#39;block&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.tips&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
</span><span class='line'>            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.tips&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">isiOS</span><span class="p">){</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.down&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>                <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;https://itunes.apple.com/us/app/jie-ji-bu-yu-qian-pao-ban/id1192650760&#39;</span><span class="p">;</span>
</span><span class='line'>                <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;https://itunes.apple.com/us/app/jie-ji-bu-yu-qian-pao-ban/id1192650760&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.start_btn&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">url</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;wbjjbyapp://wbjjby/openwith?username=&quot;</span><span class="o">+</span> <span class="nx">username</span> <span class="o">+</span><span class="s2">&quot;&amp;passwd=&quot;</span><span class="o">+</span> <span class="nx">passwd</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;wbjjbyapp://wbjjby/openwith?username=&quot;</span><span class="o">+</span> <span class="nx">username</span> <span class="o">+</span><span class="s2">&quot;&amp;passwd=&quot;</span><span class="o">+</span> <span class="nx">passwd</span><span class="p">;</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">ifr</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">ifr</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//blog.csdn.net/jsonya/article/details/url;</span>
</span><span class='line'>                <span class="nx">ifr</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>                <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ifr</span><span class="p">);</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">isAndroid</span><span class="p">){</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.down&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">confirm</span><span class="p">(</span><span class="s2">&quot;是否下载？&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="o">==</span><span class="kc">true</span><span class="p">){</span>
</span><span class='line'>                    <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;http://downcdn.boxwan.cn/buyu/fish_10000.apk&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.start_btn&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>                <span class="c1">// var url=&quot;wbjjby://?webcode=22222&quot;;</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;wbjjby://?username=&quot;</span><span class="o">+</span> <span class="nx">username</span> <span class="o">+</span><span class="s2">&quot;&amp;passwd=&quot;</span><span class="o">+</span> <span class="nx">passwd</span><span class="p">;</span> <span class="c1">//&quot;shareapp://?webCode=405096&quot;;</span>
</span><span class='line'>                <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</span><span class='line'>                <span class="nb">document</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'>                <span class="c1">// window.location.href=http://blog.csdn.net/jsonya/article/details/url;</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/20170424/javascriptshi-jian-wei-tuo/">Javascript事件委托</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-24T17:48:40+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>5:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>基本概念</h3>

<p>事件委托，通俗地来讲，就是把一个元素响应事件（click、focus&hellip;&hellip;）的函数委托到另一个元素；</p>

<p>一般来讲，会把一个或者一组元素的事件委托到它的父层或者更外层元素上，真正绑定事件的是外层元素，当事件响应到需要绑定的元素上时，会通过事件冒泡机制从而触发它的外层元素的绑定事件上，然后在外层元素上去执行函数。</p>

<p>举个例子，比如一个宿舍的同学同时快递到了，一种方法就是他们都傻傻地一个个去领取，还有一种方法就是把这件事情委托给宿舍长，让一个人出去拿好所有快递，然后再根据收件人一一分发给每个宿舍同学；</p>

<p>在这里，取快递就是一个事件，每个同学指的是需要响应事件的 DOM 元素，而出去统一领取快递的宿舍长就是代理的元素，所以真正绑定事件的是这个元素，按照收件人分发快递的过程就是在事件执行中，需要判断当前响应的事件应该匹配到被代理元素中的哪一个或者哪几个。</p>

<h3>事件冒泡</h3>

<p>前面提到 DOM 中事件委托的实现是利用事件冒泡的机制，那么事件冒泡是什么呢？</p>

<p>在 document.addEventListener 的时候我们可以设置事件模型：事件冒泡、事件捕获，一般来说都是用事件冒泡的模型；</p>

<p><img src="http://oot79f1a9.bkt.clouddn.com/QQ20170424-192929.png" alt="事件冒泡模型" /></p>

<p>如上图所示，事件模型是指分为三个阶段：</p>

<ul>
<li>捕获阶段：在事件冒泡的模型中，捕获阶段不会响应任何事件；</li>
<li>目标阶段：目标阶段就是指事件响应到触发事件的最底层元素上；</li>
<li>冒泡阶段：冒泡阶段就是事件的触发响应会从最底层目标一层层地向外到最外层（根节点），事件代理即是利用事件冒泡的机制把里层所需要响应的事件绑定到外层；</li>
</ul>


<h3>事件委托的优点</h3>

<ol>
<li>减少内存消耗</li>
</ol>


<p>试想一下，若果我们有一个列表，列表之中有大量的列表项，我们需要在点击列表项的时候响应一个事件；</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 3<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  ......
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item n<span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>// ...... 代表中间还有未知数个 li
</span></code></pre></td></tr></table></div></figure>


<p>如果给每个列表项一一都绑定一个函数，那对于内存消耗是非常大的，效率上需要消耗很多性能；</p>

<p>因此，比较好的方法就是把这个点击事件绑定到他的父层，也就是 <code>ul</code> 上，然后在执行事件的时候再去匹配判断目标元素；</p>

<p>所以事件委托可以减少大量的内存消耗，节约效率。</p>

<ol>
<li>动态绑定事件</li>
</ol>


<p>比如上述的例子中列表项就几个，我们给每个列表项都绑定了事件；</p>

<p>在很多时候，我们需要通过 AJAX 或者用户操作动态的增加或者去除列表项元素，那么在每一次改变的时候都需要重新给新增的元素绑定事件，给即将删去的元素解绑事件；</p>

<p>如果用了事件委托就没有这种麻烦了，因为事件是绑定在父层的，和目标元素的增减是没有关系的，执行到目标元素是在真正响应执行事件函数的过程中去匹配的；</p>

<p>所以使用事件在动态绑定事件的情况下是可以减少很多重复工作的。</p>

<h3>jQuery 中的事件委托</h3>

<p>jQuery 中的事件委托相信很多人都用过，它主要这几种方法来实现：</p>

<ul>
<li>$.on : 基本用法: $(&lsquo;.parent&rsquo;).on(&lsquo;click&rsquo;, &lsquo;a&rsquo;, function () { console.log(&lsquo;click event on tag a&rsquo;); })，它是 .parent 元素之下的 a 元素的事件代理到 $(&lsquo;.parent&rsquo;) 之上，只要在这个元素上有点击事件，就会自动寻找到 .parent 元素下的 a 元素，然后响应事件；</li>
<li>$.delegate : 基本用法: $(&lsquo;.parent&rsquo;).delegate(&lsquo;a&rsquo;, &lsquo;click&rsquo;, function () { console.log(&lsquo;click event on tag a&rsquo;); })，同上，并且还有相对应的 $.delegate 来删除代理的事件；</li>
<li>$.live : 基本使用方法: $(&lsquo;a&rsquo;, $(&lsquo;.parent&rsquo;)).live(&lsquo;click&rsquo;, function () { console.log(&lsquo;click event on tag a&rsquo;); })，同上，然而如果没有传入父层元素 $(.parent)，那事件会默认委托到 $(document) 上；(已废除)</li>
</ul>


<h3>基本实现</h3>

<p>比如我们有这样的一个 HTML 片段：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 3<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  ......
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item n<span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>// ...... 代表中间还有未知数个 li
</span></code></pre></td></tr></table></div></figure>


<p>我们来实现把 #list 下的 li 元素的事件代理委托到它的父层元素也就是 #list 上：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// 给父层元素绑定事件</span>
</span><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 兼容性处理</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// 判断是否匹配目标元素</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLocaleLowerCase</span> <span class="o">===</span> <span class="s1">&#39;li&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;the content is: &#39;</span><span class="p">,</span> <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>在上述代码中， target 元素则是在 #list 元素之下具体被点击的元素，然后通过判断 target 的一些属性（比如：nodeName，id 等等）可以更精确地匹配到某一类 #list li 元素之上；</p>

<h3>使用 Element.matches 精确匹配</h3>

<p>如果改变下 HTML 成：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li</span> <span class="na">className=</span><span class="s">&quot;class-1&quot;</span><span class="nt">&gt;</span>item 1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item 2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li</span> <span class="na">className=</span><span class="s">&quot;class-1&quot;</span><span class="nt">&gt;</span>item 3<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  ......
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>item n<span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>// ...... 代表中间还有未知数个 li
</span></code></pre></td></tr></table></div></figure>


<p>这里，我们想把 #list 元素下的 li 元素（并且它的 class 为 class-1）的点击事件委托代理到 #list 之上；</p>

<p>如果通过上述的方法我们还需要在 <code>if (target.nodeName.toLocaleLowerCase === 'li')</code> 判断之中在加入一个判断 <code>target.nodeName.className === 'class-1'</code>；</p>

<p>但是如果想像 CSS 选择其般做更加灵活的匹配的话，上面的判断未免就太多了，并且很难做到灵活性，这里可以使用 Element.matches API 来匹配；</p>

<p>Element.matches API 的基本使用方法: <code>Element.matches(selectorString)，selectorString</code> 既是 CSS 那样的选择器规则，比如本例中可以使用 <code>target.matches('li.class-1')</code>，他会返回一个布尔值，如果 target 元素是标签 li 并且它的类是 class-1 ，那么就会返回 true，否则返回 false；</p>

<p>当然它的兼容性还有一些问题，需要 IE9 及以上的现代化浏览器版本；</p>

<p>我们可以使用 Polyfill 来解决兼容性上的问题：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mozMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">msMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">oMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">webkitMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">document</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">).</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">i</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">!==</span> <span class="k">this</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>加上 Element.matches 之后就可以来实现我们的需求了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mozMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">msMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">oMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">webkitMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>    <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">document</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">).</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">i</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">!==</span> <span class="k">this</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 兼容性处理</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s1">&#39;li.class-1&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;the content is: &#39;</span><span class="p">,</span> <span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>函数封装</h3>

<p>在应对更多场景上我们可以把事件代理的功能封装成一个公用函数，这样就可以重复利用了。</p>

<p>结合上面的例子来实现一个函数 eventDelegate，它接受四个参数：</p>

<ul>
<li>[String] 一个选择器字符串用于过滤需要实现代理的父层元素，既事件需要被真正绑定之上；</li>
<li>[String] 一个选择器字符串用于过滤触发事件的选择器元素的后代，既我们需要被代理事件的元素；</li>
<li>[String] 一个或多个用空格分隔的事件类型和可选的命名空间，如 click 或 keydown.click ;</li>
<li>[Function] 需要代理事件响应的函数；</li>
</ul>


<p>这里就有几个关键点：</p>

<ul>
<li>对于父层代理的元素可能有多个，需要一一绑定事件；</li>
<li>对于绑定的事件类型可能有多个，需要一一绑定事件；</li>
<li>在处理匹配被代理的元素之中需要考虑到兼容性问题；</li>
<li>在执行所绑定的函数的时候需要传入正确的参数以及考虑到 <code>this</code> 的问题；</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">eventDelegate</span> <span class="p">(</span><span class="nx">parentSelector</span><span class="p">,</span> <span class="nx">targetSelector</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">foo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 触发执行的函数</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">triFunction</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 兼容性处理</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// 处理 matches 的兼容性</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span>
</span><span class='line'>        <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matchesSelector</span> <span class="o">||</span>
</span><span class='line'>        <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mozMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>        <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">msMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>        <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">oMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>        <span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">webkitMatchesSelector</span> <span class="o">||</span>
</span><span class='line'>        <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nb">document</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">).</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span>
</span><span class='line'>            <span class="nx">i</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>          <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">!==</span> <span class="k">this</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// 判断是否匹配到我们所需要的元素上</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">targetSelector</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// 执行绑定的函数，注意 this</span>
</span><span class='line'>      <span class="nx">foo</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// 如果有多个事件的话需要全部一一绑定事件</span>
</span><span class='line'>  <span class="nx">events</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 多个父层元素的话也需要一一绑定</span>
</span><span class='line'>    <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">parentSelector</span><span class="p">)).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$p</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">$p</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">triFunction</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/20170429/tu-pian-yu-jia-zai/">图片预加载</a>
      </li>
    
      <li class="post">
        <a href="/blog/20170428/javascriptkuang-jia-she-ji-jie-shao/">Javascript框架设计介绍</a>
      </li>
    
      <li class="post">
        <a href="/blog/20170428/es6xue-xi/">ES6学习</a>
      </li>
    
      <li class="post">
        <a href="/blog/20170427/gao-xing-neng-gun-dong-scrollji-ye-mian-xuan-ran-you-hua/">高性能滚动scroll及页面渲染优化</a>
      </li>
    
      <li class="post">
        <a href="/blog/20170426/javascriptyi-bu-bian-cheng/">Javascript异步编程</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
